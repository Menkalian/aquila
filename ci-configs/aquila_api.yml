.api:
  before_script:
    - cd aquila-api
    - chmod +x gradlew
  cache:
    key: aquila-api
    paths:
      - aquila-api/.gradle
  except:
    changes:
      - aquila-app/*/version.properties

apiBuild:
  stage: lib-build
  script:
    - ./gradlew publishToMavenLocal
  extends:
    - .api
  artifacts:
    paths:
      - aquila-api/build
    expire_in: 1 week

apiTest:
  stage: lib-test
  script:
    - ./gradlew test
  extends:
    - .api

apiPublish:
  stage: lib-deploy
  script:
    - ./gradlew publish
  extends:
    - .api
    - .deployment
  artifacts:
    paths:
      - aquila-api/build/libs/*.jar
    expire_in: 1 month